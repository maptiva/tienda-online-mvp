üìç Plan: Geolocalizaci√≥n con Geocodificaci√≥n Autom√°tica
‚ö†Ô∏è PROBLEMA BLOQUEANTE ENCONTRADO
Antes de implementar geolocalizaci√≥n, DEBE resolverse el problema de guardado en 

StoreSettings.jsx
:

Error Actual
duplicate key value violates unique constraint "stores_store_name_key"
duplicate key value violates unique constraint "stores_store_slug_key"
Causa Ra√≠z
La tabla stores tiene registros duplicados/corruptos
El upsert no funciona correctamente porque user_id no es la clave primaria
Las restricciones UNIQUE en store_name y store_slug causan conflictos
Soluci√≥n Requerida (ANTES de geolocalizaci√≥n)
Opci√≥n A: Limpiar base de datos

-- 1. Ver registros duplicados
SELECT * FROM stores ORDER BY user_id, created_at;
-- 2. Eliminar duplicados (mantener solo el m√°s reciente por user_id)
DELETE FROM stores 
WHERE id NOT IN (
  SELECT MAX(id) 
  FROM stores 
  GROUP BY user_id
);
Opci√≥n B: Cambiar l√≥gica de upsert

// En StoreSettings.jsx - handleSubmit
const { error: upsertError } = await supabase
  .from('stores')
  .upsert(dataToSave, {
    onConflict: 'user_id',  // Requiere que user_id sea UNIQUE constraint
    ignoreDuplicates: false
  });
Opci√≥n C: Volver a UPDATE manual (m√°s seguro)

// Primero buscar store por user_id
const { data: existing } = await supabase
  .from('stores')
  .select('id')
  .eq('user_id', user.id)
  .maybeSingle();  // No falla si no existe
if (existing) {
  // UPDATE solo los campos que cambiaron
  await supabase
    .from('stores')
    .update(dataToSave)
    .eq('id', existing.id);  // Usar ID, no user_id
} else {
  // INSERT nuevo
  await supabase
    .from('stores')
    .insert(dataToSave);
}
üó∫Ô∏è IMPLEMENTACI√ìN DE GEOLOCALIZACI√ìN (Despu√©s de resolver el guardado)
1. Base de Datos (YA HECHO ‚úÖ)
Script: 

sql/17_add_geolocation.sql

ALTER TABLE stores 
ADD COLUMN IF NOT EXISTS latitude DECIMAL(10, 8),
ADD COLUMN IF NOT EXISTS longitude DECIMAL(11, 8),
ADD COLUMN IF NOT EXISTS show_map BOOLEAN DEFAULT false;
Estado: ‚úÖ Ejecutado en Supabase

2. Dependencias (YA INSTALADO ‚úÖ)
npm install react-leaflet leaflet
Estado: ‚úÖ Instalado

3. Componente StoreMap (YA CREADO ‚úÖ)
Archivo: 

src/components/StoreMap.jsx

Caracter√≠sticas implementadas:

‚úÖ Mapa interactivo con Leaflet
‚úÖ Marcador arrastrable (prop draggable)
‚úÖ Zoom con rueda del mouse (scrollWheelZoom={true})
‚úÖ Callback onPositionChange para actualizar coordenadas
‚úÖ Popup con nombre y direcci√≥n de tienda
Uso:

<StoreMap
  latitude={-34.6037}
  longitude={-58.3816}
  storeName="Mi Tienda"
  address="Av. Corrientes 1234"
  draggable={true}  // Solo en preview del admin
  onPositionChange={(newPos) => {
    // Actualizar coordenadas cuando se arrastra
    setCoords(newPos);
  }}
/>
4. Formulario Admin (StoreSettings.jsx)
Cambios a realizar:

4.1. Agregar estado para geocoding
const [geocoding, setGeocoding] = useState(false);
const [showMapPreview, setShowMapPreview] = useState(false);
4.2. Funci√≥n de geocodificaci√≥n (Nominatim - GRATIS)
const handleGeocode = async () => {
  if (!storeData.address) {
    Swal.fire('Error', 'Ingresa una direcci√≥n completa', 'warning');
    return;
  }
  setGeocoding(true);
  try {
    const response = await fetch(
      `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(storeData.address)}&limit=1`
    );
    const data = await response.json();
    if (data && data.length > 0) {
      const { lat, lon } = data[0];
      setStoreData(prev => ({
        ...prev,
        latitude: parseFloat(lat),
        longitude: parseFloat(lon)
      }));
      setShowMapPreview(true);
      Swal.fire('¬°Ubicaci√≥n encontrada!', 'Verifica el marcador', 'success');
    } else {
      Swal.fire('No encontrado', 'Intenta ser m√°s espec√≠fico', 'warning');
    }
  } catch (error) {
    Swal.fire('Error', 'Problema al buscar direcci√≥n', 'error');
  } finally {
    setGeocoding(false);
  }
};
4.3. UI del formulario
{/* Secci√≥n Ubicaci√≥n */}
<div className="border-t pt-6 mt-6">
  <h3>üìç Ubicaci√≥n de la Tienda</h3>
  
  {/* Bot√≥n Geocodificar */}
  <button
    type="button"
    onClick={handleGeocode}
    disabled={geocoding || !storeData.address}
  >
    {geocoding ? 'Buscando...' : 'üîç Buscar en Mapa'}
  </button>
  <p className="text-xs">
    Primero completa "Direcci√≥n", luego haz clic aqu√≠
  </p>
  {/* Preview del mapa (solo despu√©s de geocodificar) */}
  {showMapPreview && storeData.latitude && storeData.longitude && (
    <div className="mb-4">
      <p>Vista previa:</p>
      <div className="h-64">
        <StoreMap
          latitude={storeData.latitude}
          longitude={storeData.longitude}
          storeName={storeData.store_name}
          address={storeData.address}
          draggable={true}
          onPositionChange={(newPos) => {
            setStoreData(prev => ({
              ...prev,
              latitude: newPos.latitude,
              longitude: newPos.longitude
            }));
          }}
        />
      </div>
      <p className="text-xs">
        üìå {storeData.latitude?.toFixed(6)}, {storeData.longitude?.toFixed(6)}
      </p>
      <p className="text-xs text-blue-600">
        üí° Arrastra el marcador para ajustar
      </p>
    </div>
  )}
  {/* Toggle mostrar mapa */}
  <label>
    <input
      type="checkbox"
      checked={storeData.show_map}
      onChange={(e) => setStoreData(prev => ({...prev, show_map: e.target.checked}))}
    />
    Mostrar mapa en mi tienda
  </label>
</div>
5. Integraci√≥n en ProductList (YA HECHO ‚úÖ)
Archivo: 

src/components/ProductList.jsx

C√≥digo agregado:

{/* Mapa de ubicaci√≥n - solo si est√° habilitado */}
{store?.show_map && store?.latitude && store?.longitude && (
  <div className="mt-12 mb-8">
    <h2>üìç Nuestra Ubicaci√≥n</h2>
    
    {/* Desktop: Mapa interactivo */}
    <div className="hidden md:block h-[300px]">
      <StoreMap
        latitude={store.latitude}
        longitude={store.longitude}
        storeName={store.store_name}
        address={store.address}
      />
    </div>
    {/* M√≥vil: Bot√≥n a Google Maps */}
    <div className="md:hidden">
      <a
        href={`https://www.google.com/maps?q=${store.latitude},${store.longitude}`}
        target="_blank"
        rel="noopener noreferrer"
      >
        üìç Ver Ubicaci√≥n en Mapa
      </a>
    </div>
    {store.address && <p>{store.address}</p>}
  </div>
)}
üìã CHECKLIST DE IMPLEMENTACI√ìN
Pre-requisitos
 CR√çTICO: Resolver problema de guardado en StoreSettings
 Limpiar registros duplicados en base de datos
 Verificar que UPDATE funciona correctamente
 Probar guardar cambios sin errores
Implementaci√≥n
 Ejecutar SQL migration (17_add_geolocation.sql)
 Instalar react-leaflet y leaflet
 Crear componente StoreMap con marcador arrastrable
 Agregar geocodificaci√≥n a StoreSettings
 Agregar preview de mapa en StoreSettings
 Integrar mapa en ProductList (responsive)
 Probar flujo completo:
Ingresar direcci√≥n
Geocodificar
Ajustar marcador
Guardar
Ver en tienda p√∫blica
Testing
 Probar geocodificaci√≥n con direcciones de Argentina
 Probar arrastrar marcador y verificar coordenadas
 Probar zoom con rueda del mouse
 Verificar responsive (desktop vs m√≥vil)
 Verificar que toggle show_map funciona
üéØ FLUJO DE USUARIO FINAL
Usuario va a Configuraci√≥n ‚Üí Ubicaci√≥n
Completa campo "Direcci√≥n" (ej: "Av. Corrientes 1234, Buenos Aires, Argentina")
Click en "üîç Buscar en Mapa"
Sistema geocodifica y muestra preview del mapa
Usuario arrastra el marcador si no est√° exacto
Usuario hace zoom con rueda del mouse para verificar
Activa "Mostrar mapa en mi tienda"
Click en "Guardar Configuraci√≥n"
El mapa aparece en la tienda p√∫blica (footer)
üö® NOTAS IMPORTANTES
Nominatim (OpenStreetMap) es GRATIS pero tiene l√≠mites de rate:

M√°ximo 1 request por segundo
Incluir User-Agent en headers (buena pr√°ctica)
Google Places Autocomplete es mejor pero CUESTA DINERO:

Autocomplete de direcciones
M√°s preciso
Requiere API Key y billing habilitado
Alternativa futura: Implementar geocoding con cach√©:

Guardar resultados de geocoding
Evitar requests repetidos
Mejorar performance
üìù ARCHIVOS MODIFICADOS
‚úÖ 

sql/17_add_geolocation.sql
 (ejecutado)
‚úÖ 

src/components/StoreMap.jsx
 (creado)
‚úÖ 

src/components/ProductList.jsx
 (integrado)
‚è∏Ô∏è 

src/pages/StoreSettings.jsx
 (pendiente - bloqueado por error de guardado)
‚úÖ 

package.json
 (dependencias instaladas)
üîÑ PR√ìXIMOS PASOS
PRIMERO: Resolver error de guardado en StoreSettings
SEGUNDO: Implementar geocodificaci√≥n en formulario
TERCERO: Testing completo
CUARTO: Deploy a producci√≥n