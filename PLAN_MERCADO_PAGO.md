# SaaS Billing System for Clicando (Mercado Pago)

This plan outlines the automation of monthly maintenance payments for Clicando merchants using Mercado Pago links and automated WhatsApp reminders.

## User Review Required

> [!IMPORTANT]
> **Admin Integration:** The payment links will be generated by the SuperAdmin (Alejandro) and sent to clients. We need to decide if the link should be static (per client) or dynamic (generated monthly).
>
> **WhatsApp Reminders:** We will implement a "Send Payment Reminder" button in the CRM that automatically crafts the message with the MP link.

## Proposed Changes

### CRM (Admin Side)
#### [MODIFY] [Clients.jsx](file:///c:/Users/ALE/Desktop/TRABAJOS%20EN%20SOLIDO/MAPTIVA/tienda-online-mvp/src/pages/admin/crm/Clients.jsx)
1. Add a "ðŸ”” Enviar Recordatorio" button for clients with "Pago Pendiente".
2. Integrate logic to generate a Mercado Pago payment link for the monthly fee.

#### [MODIFY] [PaymentModal.jsx](file:///c:/Users/ALE/Desktop/TRABAJOS%20EN%20SOLIDO/MAPTIVA/tienda-online-mvp/src/components/crm/PaymentModal.jsx)
1. Optionally allow generating a link directly from the modal to copy/paste.

---

### Backend (Supabase Edge Functions)
#### [NEW] `create-subscription-payment`
A function that:
1. Receives `client_id` and the amount to charge.
2. Uses the **Master Mercado Pago Access Token** (Alejandro's).
3. Returns a payment link (`init_point`).
4. (Optional) Could record the intention of payment.

---

### Logic & Automation
1. **Billing Cycle:** The system already detects payments from the 1st to the 10th.
2. **Dynamic Links:** Links will include the monthly maintenance fee and the client's name for identification in Mercado Pago.

## Verification Plan

### Manual Verification
1. **Reminder Flow:**
   - In the CRM, identify a client with "Pago Pendiente".
   - Click "Enviar Recordatorio".
   - Verify that it opens WhatsApp with a message like: *"Hola [Nombre], te recordamos que estÃ¡ disponible el pago del mantenimiento del 1 al 10. Puedes pagar aquÃ­: [Link MP]"*.
2. **Payment Link:**
   - Click the generated link and verify it shows the correct amount and "Mantenimiento Clicando - [Cliente]".
