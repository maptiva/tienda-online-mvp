Plan de Implementaci√≥n: Zod Validation (Fase 2)
Implementaci√≥n de validaci√≥n en runtime usando Zod para proteger la aplicaci√≥n contra datos corruptos o inesperados.

üéØ Objetivo
Agregar una capa de validaci√≥n de tipos en runtime que:

Valide respuestas de Supabase antes de usarlas
Proteja contra datos corruptos o mal formateados
Proporcione mensajes de error claros cuando los datos no cumplan el schema
Sirva como documentaci√≥n viva de las estructuras de datos
üìã Cambios Propuestos
1. Instalaci√≥n de Dependencias
bash
npm install zod
2. Estructura de Schemas
Crear src/schemas/ con los siguientes archivos:

product.schema.js
Validaci√≥n para productos:


id
, name, price, stock, image_url
category (relaci√≥n con categor√≠as)
user_id (owner)
Campos opcionales: description, is_active
category.schema.js
Validaci√≥n para categor√≠as:


id
, name, user_id
Campos opcionales: description, order
store.schema.js
Validaci√≥n para datos de tiendas:


id
, store_name, user_id
Campos opcionales: logo_url, address, city, category
Campos de contacto: contact_phone, instagram_url, etc.
cart.schema.js
Validaci√≥n para items del carrito:

productId, quantity, price
Validaciones: quantity > 0, price >= 0
3. Integraci√≥n en Hooks
Modificar hooks existentes para usar validaci√≥n:


useProducts.js

javascript
import { productSchema } from '../schemas/product.schema';
// Validar respuesta de Supabase
const validatedData = data.map(item => productSchema.parse(item));
useCategories.js

javascript
import { categorySchema } from '../schemas/category.schema';
const validatedData = data.map(item => categorySchema.parse(item));
4. Manejo de Errores de Validaci√≥n
Crear helper en src/utils/zodHelpers.js:

javascript
export function safeValidate(schema, data) {
  const result = schema.safeParse(data);
  if (!result.success) {
    console.error('Validation error:', result.error);
    return { data: null, error: result.error };
  }
  return { data: result.data, error: null };
}
üß™ Plan de Testing
Crear tests para schemas:

src/schemas/__tests__/product.schema.test.js
src/schemas/__tests__/category.schema.test.js
Tests deben cubrir:

‚úÖ Datos v√°lidos pasan la validaci√≥n
‚ùå Datos inv√°lidos fallan con mensaje claro
‚ö†Ô∏è Campos opcionales funcionan correctamente
üî¢ Validaciones num√©ricas (price >= 0, stock >= 0)
üìä Priorizaci√≥n
Alto Impacto (Implementar primero):

product.schema.js - Los productos son el core del negocio
cart.schema.js - Protege el flujo de compra
Medio Impacto: 3. category.schema.js - Menos cr√≠tico pero importante 4. store.schema.js - Datos de configuraci√≥n

‚ö†Ô∏è Consideraciones
Performance: Zod es r√°pido pero validar arrays grandes puede tener impacto. Usar safeParse en producci√≥n.
Backward Compatibility: Los schemas deben ser flexibles con campos opcionales para no romper datos existentes.
Error Messages: Personalizar mensajes de error para que sean user-friendly.
‚úÖ Criterios de √âxito
 Zod instalado y configurado
 Schemas creados para Product, Category, Store, Cart
 Hooks principales usando validaci√≥n
 Tests pasando para todos los schemas
 Documentaci√≥n actualizada en CODE_QUALITY_PLAN.md